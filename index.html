<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MTFCM - Multi-Timeframe Confluence Monitor for halal spot crypto trading. Analyze multiple timeframes with real-time Binance data.">
    <title>MTFCM - Multi-Timeframe Confluence Monitor</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button id="sidebarToggle" class="btn btn-coins" title="Coins">üí∞ <span class="coins-text">Coins</span></button>
            </div>
            <div class="header-center">
                <img src="logo.svg" alt="MTFCM" class="header-logo-img" width="28" height="28">
                <h1>MTFCM</h1>
            </div>
            <div class="header-actions">
                <div class="alert-badge alert-badge-compact" id="alertBadge" style="display: none;">
                    <span class="pulse"></span>
                    <span id="alertCount">0</span>
                </div>
                <a href="backtest.html" class="btn btn-icon" title="Strategy Tester" style="text-decoration:none;font-size:0.85rem;">üß™</a>
                <span class="connection-dot" id="connectionDot" title="API Status">‚óè</span>
                <button id="themeToggle" class="btn btn-icon btn-theme" title="Toggle Theme (T)">üåô</button>
            </div>
        </header>

        <!-- Main Layout with Sidebar -->
        <div class="app-layout">
            <!-- Coins Sidebar -->
            <aside class="coins-sidebar" id="coinsSidebar">
                <div class="sidebar-header">
                    <h3>üí∞ Coins</h3>
                    <div class="sidebar-header-actions">
                        <button class="btn btn-icon sidebar-close mobile-only" id="sidebarClose">‚úï</button>
                    </div>
                </div>
                <!-- Sidebar Tabs -->
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" data-tab="all-coins">All Coins</button>
                    <button class="sidebar-tab" data-tab="watchlist">‚≠ê Watchlist</button>
                </div>
                <input type="text" id="coinSearch" placeholder="Search coins..." class="coin-search">
                <div class="coin-sort-options">
                    <label>Sort:</label>
                    <div class="fancy-select" id="coinSortFancy">
                        <select id="coinSortSelect">
                            <option value="default">Default</option>
                            <option value="alpha">A-Z</option>
                            <option value="alpha-desc">Z-A</option>
                            <option value="volume">Volume ‚Üì</option>
                            <option value="change">24h Change ‚Üì</option>
                            <option value="change-asc">24h Change ‚Üë</option>
                        </select>
                    </div>
                </div>
                <div class="coins-list" id="coinsList">
                    <!-- Coins will be loaded dynamically -->
                </div>
                <div class="watchlist-list" id="watchlistList" style="display: none;">
                    <!-- Watchlist coins will be loaded dynamically -->
                    <div class="watchlist-empty">
                        <p>No coins in watchlist</p>
                        <small>Click ‚≠ê on any coin to add</small>
                    </div>
                </div>
            </aside>
            
            <!-- Sidebar Overlay for Mobile -->
            <div class="sidebar-overlay" id="sidebarOverlay"></div>

            <!-- Main Content Area (Single Coin View) -->
            <main class="main-content" id="singleCoinView">
                <!-- Top Ad Banner (Halal-Filtered) - scrolls with content -->
                <div class="ad-container ad-banner-top" id="adBannerTop">
                    <div class="ad-placeholder">
                        <div class="ad-slot" id="adSlotTop">
                            <!-- AdSense auto ad or manual ad unit -->
                        </div>
                    </div>
                </div>

                <!-- Confluence Section (Price moved to header) -->
                <section class="card confluence-card">
                    <div class="card-header">
                        <h2>üìä Confluence</h2>
                        <button class="btn btn-sm btn-card-settings" id="confluenceSettingsBtn" title="Confluence Settings">‚öôÔ∏è</button>
                    </div>
                    <!-- Confluence Settings (collapsible) -->
                    <div class="card-settings" id="confluenceSettings" style="display: none;">
                        <div class="card-settings-row">
                            <label for="weightMethod">TF Weight Method</label>
                            <div class="fancy-select">
                                <select id="weightMethod">
                                    <option value="equal">Equal</option>
                                    <option value="linear" selected>Linear</option>
                                    <option value="exponential">Exponential</option>
                                    <option value="tiered">Tiered</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-settings-row">
                            <label>Modifiers</label>
                            <div class="modifier-toggles">
                                <label class="mini-toggle"><input type="checkbox" id="useStrengthMod" checked><span>Body</span></label>
                                <label class="mini-toggle"><input type="checkbox" id="useVolumeMod" checked><span>Vol</span></label>
                                <label class="mini-toggle"><input type="checkbox" id="useIndicatorMod" checked><span>Ind</span></label>
                            </div>
                        </div>
                    </div>
                    <div class="confluence-content">
                        <div class="confluence-meter">
                            <div class="meter-bar">
                                <div class="meter-fill" id="confluenceFill"></div>
                            </div>
                            <div class="meter-labels">
                                <span>üî¥</span>
                                <span>üü°</span>
                                <span>üü¢</span>
                            </div>
                        </div>
                        <div class="confluence-stats">
                            <div class="stat" id="confluenceScore">
                                <span class="stat-value">50%</span>
                                <span class="stat-label">Score</span>
                            </div>
                            <div class="stat" id="bullCount">
                                <span class="stat-value text-bull">0</span>
                                <span class="stat-label">Bull</span>
                            </div>
                            <div class="stat" id="bearCount">
                                <span class="stat-value text-bear">0</span>
                                <span class="stat-label">Bear</span>
                            </div>
                            <div class="stat" id="biasIndicator">
                                <span class="stat-value">‚Äî</span>
                                <span class="stat-label">Bias</span>
                            </div>
                            <div class="stat" id="signalIndicator">
                                <span class="stat-value signal-value">‚Äî</span>
                                <span class="stat-label">Signal</span>
                            </div>
                        </div>
                        <div class="confluence-method" id="confluenceMethod">
                            <div class="method-title">Method: <span id="methodName">Linear</span></div>
                            <div class="method-formula" id="methodFormula">Loading...</div>
                            <div class="method-weights" id="methodWeights"></div>
                            <div class="methods-comparison" id="methodsComparison">
                                <div class="methods-compare-header" id="methodsCompareToggle">
                                    <span>üìê Compare All Methods</span>
                                    <span class="methods-compare-icon">‚ñº</span>
                                </div>
                                <div class="methods-compare-body" id="methodsCompareBody" style="display:none;"></div>
                            </div>
                        </div>
                        <!-- Historical Confluence Tracking -->
                        <div class="confluence-history" id="confluenceHistory">
                            <div class="history-header" id="historyToggle">
                                <span>üìú Recent High Confluence</span>
                                <span class="history-toggle-icon">‚ñº</span>
                            </div>
                            <div class="history-list" id="historyList">
                                <div class="history-empty">No high confluence moments recorded yet</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Coin TF Blocks Area (Main + Added + Add Button) -->
                <div class="tf-blocks-area" id="tfBlocksArea">
                    <!-- Main Coin TF Block with FULL settings -->
                    <div class="tf-block main-tf-block" id="mainTfBlock">
                        <div class="tf-block-header">
                            <span class="tf-block-title">
                                <div class="coin-swap-wrapper">
                                    <div class="custom-coin-dropdown" id="mainCoinDropdown">
                                        <button class="coin-dropdown-trigger" id="mainCoinTrigger" type="button">
                                            <img class="coin-dd-icon" id="mainDDIcon" src="" onerror="this.style.display='none'">
                                            <span class="coin-dd-name" id="mainDDName">BTC</span>
                                            <span class="coin-dd-arrow">‚ñæ</span>
                                        </button>
                                        <div class="coin-dropdown-menu" id="mainCoinMenu">
                                            <input type="text" class="coin-dropdown-search" id="mainCoinDDSearch" placeholder="Search coins...">
                                            <div class="coin-dropdown-list" id="mainCoinDDList">
                                                <!-- Populated by JS -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <span class="coin-price" id="mainBlockPrice"></span>
                            </span>
                            <div class="tf-block-toggles-inline" id="mainBlockToggles">
                                <!-- TF toggle buttons loaded dynamically -->
                            </div>
                            <button class="btn btn-sm btn-card-settings" id="mainBlockSettingsBtn" title="Settings">‚öôÔ∏è</button>
                        </div>
                        <!-- FULL Settings (collapsible) -->
                        <div class="tf-block-settings" id="mainBlockSettings" style="display: none;">
                            <div class="card-settings-section">
                                <span class="settings-section-label">üîî Alerts</span>
                                <div class="card-settings-row">
                                    <label for="alertSeconds">Alert before close</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="alertSeconds" min="5" max="120" value="30">
                                        <span>sec</span>
                                    </div>
                                </div>
                                <div class="card-settings-row">
                                    <label for="minConfluence">Min TFs for alert</label>
                                    <input type="number" id="minConfluence" min="1" max="6" value="2">
                                </div>
                                <div class="card-settings-row">
                                    <label for="enableSound">Sound alerts</label>
                                    <input type="checkbox" id="enableSound" checked>
                                </div>
                            </div>
                            <div class="card-settings-section">
                                <span class="settings-section-label">üì¢ Signal Notifications</span>
                                <div class="card-settings-row">
                                    <label for="enableSignalSound">Sound on signal change</label>
                                    <input type="checkbox" id="enableSignalSound" checked>
                                </div>
                                <div class="card-settings-row">
                                    <label for="enableSignalPopup">Popup notification</label>
                                    <input type="checkbox" id="enableSignalPopup" checked>
                                </div>
                                <div class="card-settings-row">
                                    <label for="signalCooldown">Signal cooldown</label>
                                    <div class="fancy-select">
                                        <select id="signalCooldown">
                                            <option value="30">30s</option>
                                            <option value="60" selected>60s</option>
                                            <option value="120">2 min</option>
                                            <option value="300">5 min</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="card-settings-section">
                                <span class="settings-section-label">üé® Display</span>
                                <div class="card-settings-row">
                                    <label for="viewModeSelect">Display Mode</label>
                                    <div class="fancy-select">
                                        <select id="viewModeSelect">
                                            <option value="clear">Clear</option>
                                            <option value="advanced">Advanced</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-settings-row">
                                    <label for="candlePopupType">Price Info Style</label>
                                    <div class="fancy-select">
                                        <select id="candlePopupType">
                                            <option value="hover-tab">Hover Tab</option>
                                            <option value="click-popup">Click Popup</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-settings-row">
                                    <label>Show in cards</label>
                                    <div class="modifier-toggles">
                                        <label class="mini-toggle"><input type="checkbox" id="showRSI" checked><span>RSI</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showMACD" checked><span>MACD</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showVolume" checked><span>Vol</span></label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-settings-section">
                                <span class="settings-section-label">üìä Chart Indicators</span>
                                <div class="card-settings-row">
                                    <label>Show on chart</label>
                                    <div class="modifier-toggles">
                                        <label class="mini-toggle"><input type="checkbox" id="showChartVolume" checked><span>Vol</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showChartRSI"><span>RSI</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showChartMACD"><span>MACD</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showChartMA"><span>MA</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showChartEMA" checked><span>EMA</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showChartVWAP"><span>VWAP</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showChartSR"><span>S/R</span></label>
                                        <label class="mini-toggle"><input type="checkbox" id="showPriceScale"><span>Price Scale</span></label>
                                    </div>
                                </div>
                                <div class="card-settings-row">
                                    <label for="volumeTypeSelect">Volume Style</label>
                                    <div class="fancy-select">
                                        <select id="volumeTypeSelect">
                                            <option value="buysell">Buy/Sell</option>
                                            <option value="regular">Regular</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="card-settings-row">
                                    <label for="maLinesInputTF">MA Periods</label>
                                    <input type="text" id="maLinesInputTF" placeholder="20" value="20" class="input-sm">
                                </div>
                                <div class="card-settings-row">
                                    <label for="emaLinesInputTF">EMA Periods</label>
                                    <input type="text" id="emaLinesInputTF" placeholder="21" value="21" class="input-sm">
                                </div>
                            </div>
                            <div class="card-settings-section">
                                <span class="settings-section-label">üïØÔ∏è Candle Patterns</span>
                                <div class="patterns-grid">
                                    <label class="pattern-toggle"><input type="checkbox" id="patternDoji" checked><span>Doji</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternHammer" checked><span>Hammer</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternInvHammer" checked><span>Inv Hammer</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternHangingMan" checked><span>Hanging Man</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternShootStar" checked><span>Shoot Star</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternMarubozu" checked><span>Marubozu</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternSpinTop" checked><span>Spin Top</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternBullEngulf" checked><span>Bull Engulf</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternBearEngulf" checked><span>Bear Engulf</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternBullHarami" checked><span>Bull Harami</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternBearHarami" checked><span>Bear Harami</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternPiercing" checked><span>Piercing</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternDarkCloud" checked><span>Dark Cloud</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternTweezTop" checked><span>Tweez Top</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternTweezBot" checked><span>Tweez Bot</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternMorningStar" checked><span>Morning ‚≠ê</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="patternEveningStar" checked><span>Evening ‚≠ê</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="pattern3Soldiers" checked><span>3 Soldiers</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="pattern3Crows" checked><span>3 Crows</span></label>
                                </div>
                                <div class="pattern-actions">
                                    <button class="btn btn-xs" id="selectAllPatterns">Select All</button>
                                    <button class="btn btn-xs" id="deselectAllPatterns">Deselect All</button>
                                </div>
                            </div>
                            <div class="card-settings-section">
                                <span class="settings-section-label">üëÅÔ∏è Display Options</span>
                                <div class="display-toggles">
                                    <label class="mini-toggle"><input type="checkbox" id="showPriceInfo" checked><span>Price Info</span></label>
                                    <label class="mini-toggle"><input type="checkbox" id="showTimers" checked><span>Timers</span></label>
                                    <label class="mini-toggle"><input type="checkbox" id="showIndicatorBadges" checked><span>Indicator Badges</span></label>
                                    <label class="mini-toggle"><input type="checkbox" id="showConfluenceBar" checked><span>Confluence Bar</span></label>
                                </div>
                            </div>
                            <div class="card-settings-section">
                                <span class="settings-section-label">üì° Market Signals</span>
                                <div class="patterns-grid">
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeLowVol" checked><span>LowVol</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeHighVol" checked><span>HighVol</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeVolSpike" checked><span>VolSpike</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeMACDUp" checked><span>MACD‚Üë</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeMACDDown" checked><span>MACD‚Üì</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeMACDCrossUp" checked><span>MACDx‚Üë</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeMACDCrossDown" checked><span>MACDx‚Üì</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeRejHi" checked><span>RejHi</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeRejLo" checked><span>RejLo</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeOB" checked><span>OB</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeOS" checked><span>OS</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeExtOB" checked><span>ExtOB</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeExtOS" checked><span>ExtOS</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeIndecision" checked><span>Indeci</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeBigBody" checked><span>BigBody</span></label>
                                    <label class="pattern-toggle"><input type="checkbox" id="badgeEngulf" checked><span>Engulf</span></label>
                                </div>
                            </div>
                        </div>
                        <div class="chart-options">
                            <span class="chart-help">Scroll/Pinch to zoom ‚Ä¢ Drag to pan</span>
                        </div>
                        <!-- Charts -->
                        <div class="tf-block-charts" id="timeframesList">
                            <!-- Timeframe chart rows -->
                        </div>
                    </div>
                    
                    <!-- Added Coin TF Blocks will be inserted here -->
                    <div class="added-tf-blocks" id="addedTfBlocks">
                        <!-- Each added coin gets a complete TF block with full settings -->
                    </div>
                    
                    <!-- Add Column (+ button at top, ad below) -->
                    <div class="add-column" id="addColumn">
                        <div class="add-coin-box" id="addCoinBox">
                            <div class="custom-coin-dropdown add-coin-dd" id="addCoinDropdown">
                                <button class="coin-dropdown-trigger add-coin-trigger" type="button">
                                    <span class="add-coin-plus">+</span>
                                    <span class="add-coin-label">Add</span>
                                </button>
                                <div class="coin-dropdown-menu">
                                    <input type="text" class="coin-dropdown-search" placeholder="Search coins...">
                                    <div class="coin-dropdown-list">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Ad below the + button -->
                        <div class="ad-container ad-side-column" id="adSideColumn">
                            <div class="ad-placeholder">
                                <div class="ad-slot" id="adSlotSide"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Ad Banner (Halal-Filtered) - scrolls with content -->
                <div class="ad-container ad-banner-bottom" id="adBannerBottom">
                    <div class="ad-placeholder">
                        <div class="ad-slot" id="adSlotBottom">
                            <!-- AdSense auto ad or manual ad unit -->
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>MTFCM v4.7.4 | Binance Data | ‚ò™Ô∏è Halal - Spot Only | Feb 2026</p>
            <div class="footer-support">
                <span>Support this project:</span>
                <a href="#" id="tipJarBtn" class="tip-link">‚òï Buy me a coffee</a>
            </div>
        </footer>

        <!-- Tip Jar Modal -->
        <div class="modal modal-small" id="tipJarModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚òï Support MTFCM</h2>
                    <button class="btn btn-icon modal-close" id="closeTipJar">‚úï</button>
                </div>
                <div class="modal-body tip-jar-body">
                    <p>If MTFCM helps you trade, consider supporting its development!</p>
                    <div class="tip-options">
                        <a href="https://buymeacoffee.com/" target="_blank" class="tip-option">
                            <span class="tip-icon">‚òï</span>
                            <span>Buy Me a Coffee</span>
                        </a>
                        <a href="https://ko-fi.com/" target="_blank" class="tip-option">
                            <span class="tip-icon">‚ù§Ô∏è</span>
                            <span>Ko-fi</span>
                        </a>
                    </div>
                    <div class="crypto-tips">
                        <p>Or send crypto:</p>
                        <div class="crypto-address">
                            <span>BTC:</span>
                            <code id="btcAddress">bc1q...your_address</code>
                            <button class="btn-copy" data-copy="btcAddress">üìã</button>
                        </div>
                        <div class="crypto-address">
                            <span>ETH/USDT:</span>
                            <code id="ethAddress">0x...your_address</code>
                            <button class="btn-copy" data-copy="ethAddress">üìã</button>
                        </div>
                    </div>
                    <p class="tip-thanks">JazakAllahu Khayran! ü§≤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Signal Notification Popup -->
    <div class="signal-notification" id="signalNotification">
        <div class="signal-notif-icon"></div>
        <div class="signal-notif-text">
            <span class="signal-notif-label">Signal Changed</span>
            <span class="signal-notif-value"></span>
        </div>
        <button class="signal-notif-close" onclick="this.parentElement.classList.remove('show')">‚úï</button>
    </div>

    <script src="coins.js"></script>
    <script src="app.js"></script>
</body>
</html>
